<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.webservice.ahiru.mapper.EmployeeWorkYearMapper">
	<select id="getEmployeeWorkInfo" resultMap="EmployeeWorkYearMap" parameterType="com.webservice.ahiru.entity.SEVEmpList">
        select
        VW.ID as  employeeNo,
        VW.NAME as employeeName,
        VW.DEPROLENAME AS  department,
        VW.PMUID AS pmId,
        VW.PMNAME AS pmName,
        em_work.CASE_NAME AS caseName,
        YEAR (curdate()) AS year,
        VW.LEVEL AS level,
        VW.TECHNAME AS professional,
        VW.A1 AS useStatus01,
        VW.A2 AS useStatus02,
        VW.A3 AS useStatus03,
        VW.A4 AS useStatus04,
        VW.A5 AS useStatus05,
        VW.A6 AS useStatus06,
        VW.A7 AS useStatus07,
        VW.A8 AS useStatus08,
        VW.A9 AS useStatus09,
        VW.A10 AS useStatus10,
        VW.A11 AS useStatus11,
        VW.A12 AS useStatus12
        from V_EMP_WORK AS VW
        LEFT JOIN
        M_CODE
        ON VW.TECH = M_CODE.HANYOU_VALUE
        AND M_CODE.HANYOU_CODE='TECH_DIREC'
        LEFT JOIN
        ( SELECT T_EMP_WORK.EMPLOYEE_NO,
        T_EMP_WORK.PM_EMPLOYEE_NO,
        max(T_EMP_WORK.CASE_NAME) as CASE_NAME
        FROM T_EMP_WORK
        WHERE YEAR=YEAR (curdate())
        AND USE_MONTH = MONTH(curdate())
        group by EMPLOYEE_NO,PM_EMPLOYEE_NO
        ) as em_work
        ON
        em_work.EMPLOYEE_NO = VW.ID
        AND em_work.PM_EMPLOYEE_NO = VW.PMUID

        <where>
            <if test="name !='' and name !=null " >
                AND (ID like CONCAT('%',#{name},'%') or name like CONCAT('%',#{name},'%') )
            </if>

            <if test="levelList!= null and levelList.size>0" >
                AND LEVEL in
                <foreach collection="levelList" index="index" item ="level"  separator="," open=" (" close=")" >#{level}</foreach>
            </if>

            <if test="depRoleNameList!= null and depRoleNameList.size>0" >
                AND DEPROLENAME in <foreach collection="depRoleNameList" index="index" item ="department"  separator="," open=" (" close=")" > #{department}</foreach>
            </if>

            <if test="techNameList!= null and techNameList.size>0" >
                AND M_CODE.HANYOU_VALUE_NAME IN  <foreach collection="techNameList" index="index" item ="professional"  separator="," open=" (" close=")" >#{professional}</foreach>
            </if>

            <if test="pmName !='' and pmName !=null " >
                AND PMUID = #{pmName}
            </if>
        </where>
	</select>

	<resultMap id="EmployeeWorkYearMap" type="com.webservice.ahiru.entity.EmployeeWorkYear">
		<result property="employeeNo" column="employeeNo"/>
		<result property="employeeName" column="employeeName"/>
		<result property="department" column="department"/>
        <result property="pmId" column="pmId"/>
		<result property="pmName" column="pmName"/>
		<result property="caseName" column="caseName"/>
		<result property="level" column="level"/>
        <result property="professional" column="professional"/>
		<result property="useStatus01" column="useStatus01"/>
		<result property="useStatus02" column="useStatus02"/>
		<result property="useStatus03" column="useStatus03"/>
		<result property="useStatus04" column="useStatus04"/>
		<result property="useStatus05" column="useStatus05"/>
		<result property="useStatus06" column="useStatus06"/>
		<result property="useStatus07" column="useStatus07"/>
		<result property="useStatus08" column="useStatus08"/>
		<result property="useStatus09" column="useStatus09"/>
		<result property="useStatus10" column="useStatus10"/>
		<result property="useStatus11" column="useStatus11"/>
		<result property="useStatus12" column="useStatus12"/>
	</resultMap>
</mapper>
